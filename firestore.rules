rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // =====================================================================
    // ผู้ใช้ (Users)
    // =====================================================================
    match /users/{userId} {
      // ... (กฎเดิมของคุณ)
      allow create: if request.auth != null && request.auth.uid == userId;
      allow read, update: if request.auth != null && request.auth.uid == userId; //
      allow delete: if false; //

      // ... (กฎสำหรับ subcollections เดิมของคุณ)
      match /kycEvents/{eventId} {
        allow read, create: if request.auth != null && request.auth.uid == userId; //
        allow update, delete: if false; //
      }

      match /documents/{documentId} {
        // อนุญาตให้เจ้าของโปรไฟล์ อ่าน, สร้าง, และลบเอกสารของตนเองได้เท่านั้น
        allow read, create, delete: if request.auth != null && request.auth.uid == userId;

        // ไม่อนุญาตให้อัปเดตโดยตรง เพื่อป้องกันการแก้ไขข้อมูลโดยไม่ตั้งใจ
        allow update: if false;
      }
    }

    // =====================================================================
    // การจอง (Bookings) - (เพิ่มส่วนนี้เข้าไป)
    // =====================================================================
  match /bookings/{bookingId} {
    // อนุญาตให้อ่านและอัปเดตได้ ถ้าเป็นเจ้าของข้อมูล
    allow read, update: if request.auth != null && request.auth.uid == resource.data.userId;

    // อนุญาตให้สร้างได้ ถ้าจะสร้างข้อมูลของตัวเอง
    allow create: if request.auth != null && request.resource.data.userId == request.auth.uid;

    // ไม่อนุญาตให้ลบ
    allow delete: if false;
  }

  }
}